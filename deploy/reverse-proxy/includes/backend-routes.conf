# ---- BEGIN: backend-routes (proxied to Django backend) ----
# Health & metrics (public read-only JSON)
location /health/ {
    proxy_pass http://backend_service/health/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    add_header Cache-Control "no-store, no-cache, must-revalidate";
}

# Mail provider webhooks (Mailgun/Sendgrid) â€“ POST allowed
location /email-webhook/ {
    proxy_pass http://backend_service/email-webhook/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

# GDPR unsubscribe page
location /unsubscribe-followup/ {
    proxy_pass http://backend_service/unsubscribe-followup/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
# ---- END: backend-routes ----
